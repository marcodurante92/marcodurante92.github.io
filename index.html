<!DOCTYPE html>
<hmtl>

    <head>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <style>
            .container {
            border-radius: 5px;
            background-color: #d0d0d0;
            padding: 10px;
            width:70%;
            }

            input[type=text] {
                width: 100%;
                box-sizing: border-box;
                margin-top: 8px;
                margin-bottom: 8px;
            }

            body {
                font-family: 'Lato', sans-serif;
                display: flex;
                justify-content: center;
                align-items: center;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <form id="survey-form" onsubmit="event.preventDefault(); return submitSurvey()">
                <fieldset>
                    <legend>Mobility Survey</legend>
                    <p>
                        Gender: <INPUT TYPE="RADIO" NAME="gender" VALUE="M" required>Male
                        <INPUT TYPE="RADIO" NAME="gender" VALUE="F" required>Female
                    </p>
                    <p>
                        <label for="name-input">Nome</label>
                        <input name="name" type="text" id="name-input" value="" required />
                    </p>
                    <p>
                        <label for="surname-input">Cognome</label>
                        <input name="surname" type="text" id="surname-input" value="" required />
                    </p>
                    <p>
                        Age: <INPUT TYPE="RADIO" NAME="age-range" VALUE="min-18" required><18
                        <INPUT TYPE="RADIO" NAME="age-range" VALUE="18-30" required>18-30                            
                        <INPUT TYPE="RADIO" NAME="age-range" VALUE="31+" required>31+
                    </p>
                    <p>

                        Highest degree attained: <SELECT NAME="educ">
                            <OPTION SELECTED VALUE=""> ?
                            <OPTION VALUE="1">H.S. diploma (or equiv.)
                            <OPTION VALUE="2">Assoc. degree
                            <OPTION VALUE="3">Bachelor's degree
                            <OPTION VALUE="4">Master's degree
                            <OPTION VALUE="5">Doctoral degree
                        </SELECT></p>

                    <label for="departure-input">Partenza</label>
                    <input name="departure" type="text" id="departure-input" value="" required />
                    <button type="button" onclick="checkDistances()">Check Distances</button>

                    <div id="departure-list"></div>

                    <H3>The following series of questions ask about your feelings
                        toward your work. Select the answer that is true most of the time.</H3>


                    <P>
                        <TABLE BORDER>

                            <TR ALIGN=CENTER>
                                <TD WIDTH=75> </TD>
                                <TD WIDTH=75><B>Strongly<br>agree</B></TD>
                                <TD WIDTH=75><B>Agree</B></TD>
                                <TD WIDTH=75><B>Neither<br>agree<br>nor<br>disagree</B></TD>
                                <TD WIDTH=75><B>Disagree</B></TD>
                                <TD WIDTH=75><B>Strongly<br>disagree</B></TD>
                            </TR>

                            <TR ALIGN=CENTER>
                                <TD ALIGN=LEFT>
                                    The work is very stimulating.</TD>
                                <TD><INPUT TYPE="RADIO" NAME="stimulat" VALUE="1"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="stimulat" VALUE="2"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="stimulat" VALUE="3"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="stimulat" VALUE="4"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="stimulat" VALUE="5"></TD>
                            </TR>

                            <TR ALIGN=CENTER>
                                <TD ALIGN=LEFT>
                                    I have a lot of freedom at work.</TD>
                                <TD><INPUT TYPE="RADIO" NAME="freedom" VALUE="1"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="freedom" VALUE="2"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="freedom" VALUE="3"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="freedom" VALUE="4"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="freedom" VALUE="5"></TD>
                            </TR>

                            <TR ALIGN=CENTER>
                                <TD ALIGN=LEFT>
                                    My supervisor is very demanding of high quality.</TD>
                                <TD><INPUT TYPE="RADIO" NAME="demand" VALUE="1"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="demand" VALUE="2"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="demand" VALUE="3"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="demand" VALUE="4"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="demand" VALUE="5"></TD>
                            </TR>

                            <TR ALIGN=CENTER>
                                <TD ALIGN=LEFT>
                                    The work environment is conducive to creative thinking.</TD>
                                <TD><INPUT TYPE="RADIO" NAME="creative" VALUE="1"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="creative" VALUE="2"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="creative" VALUE="3"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="creative" VALUE="4"></TD>
                                <TD><INPUT TYPE="RADIO" NAME="creative" VALUE="5"></TD>
                            </TR>

                        </TABLE>
                        <hr>

                        <p>
                            <button type="submit" style="display: none" id="form-btn">Invia</button>
                </fieldset>

            </form>

        </div>

        <script>
            var distances = null;

            function checkDistances() {
                var departure = $("#departure-input").val(); //recupera l'elemento con id (#) uguale a 'departure-input'

                //Crea la chiamata ajax al server per recuperare la lista di distanze
                $.post('https://marcos-survey-pr-1550269884833.firebaseapp.com/api', {
                        from: departure
                    })
                    .then(function (response) {
                        distances = response.distances;
                        console.log(distances);
                        var list = "";
                        $.each(distances, function (i, element) {
                            list = list + "<li>To <b>" + element.destination + "</b> (distance: " + element
                                .distance.text + " - duration: " + element.duration.text + ")</li>"
                        })

                        $("#departure-list").append("<ul>" +
                            list +
                            "</ul>");
                        $("#form-btn").css("display", "block");
                    })


            }

            function submitSurvey() {
                var elements = $("#survey-form").serializeArray();
                var json = {};

                $.each(elements, function (i, input) {
                    json[input.name] = input.value;
                });
                console.log(json);
                var data = Object.assign({
                    distances: distances
                }, json);
                console.log(data);

                $.post('https://marcos-survey-pr-1550269884833.firebaseapp.com/api/confirmSurvey',
                        data)
                    .then(response => {
                        alert(response.message);
                    })
                return false;
            }
        </script>
    </body>
</hmtl>